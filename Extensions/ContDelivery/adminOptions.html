<html ng-app="CDActionsOptions">

<head>
    <link rel="stylesheet" href="css/app.css" />
    <script src="sdk/scripts/jquery_2.1.4.min.js"></script>
    <script src="sdk/scripts/q.js"></script>
    <script src="sdk/scripts/angular_1.3.14.min.js"></script>
    <script src="sdk/scripts/jquery_2.1.4.min.js"></script>
    <script src="sdk/scripts/VSS.SDK.js"></script>
    <script src="scripts/StoreService.js"></script>
</head>

<body style="background-color:inherit;height:100%;">
    <script type="text/javascript">
        // Initialize the VSS sdk
        VSS.init({
            usePlatformScripts: true,
            usePlatformStyles: true,
            explicitNotifyLoaded: true,
        });


        var app = angular.module('CDActionsOptions', ['ExecActions.services']);
        app.controller("ActionsController", ['$scope', '$http', '$injector', '$interval', function ($scope, $http, $injector, $interval) {
            var ctrl = this;
            this.ErrorMsg = "";
            this.InfoMsg = "";
            this.TaskOptions = "";
            this.UserStoryOptions = "";
            // Wait for the SDK to be initialized
            VSS.ready(function () {
                ctrl.BuildsService = $injector.get("BuildsConfigurationService");
                VSS.require("VSS/Controls", function (controls) {
                });
                ctrl.BuildsService.init().then(function() {
                    VSS.notifyLoadSucceeded();
                    ctrl.Reset()
                    $scope.$apply()
                })
            });                        
            this.Save = function() {
                this.BuildsService.storeOptions({UserStory:UserStoryOptions, Task:TaskOptions})
                .then(function() {ctrl.InfoMsg="Options Saved";$scope.$apply()},function(error) {console.log(error);ctrl.ErrorMsg=error.message;$scope.apply()})
            }
            this.Reset = function() {
                this.TaskOptions = JSON.stringify(this.BuildsService.Builds,null,4)
                this.UserStoryOptions = JSON.stringify(this.BuildsService.USBuilds,null,4)
            }
        }]);
        
    </script>
    <div>
        <div class="hub-view explorer" ng-controller="OptionsController as ctrl">
            <div class="splitter horizontal hub-splitter">
                <div class="leftPane">
                    <div class="left-hub-content">
                    </div>
                </div>
                <div class="handleBar"></div>
                <div class="rightPane">
                    <div class="hub-title">CD Actions Options</div>
                    <div class="right-hub-content" style="display:flex; flex-direction:column;padding-left:20px;">
                        <div class="message-area-control closeable info-message" style="max-height:50px; overflow:hidden" ng-show="tmplCtrl.InfoMsg!=''">{{ctrl.InfoMsg}}</div>
                        <div class="message-area-control closeable error-message" style="max-height:50px; overflow:hidden" ng-show="tmplCtrl.ErrorMsg!=''">{{ctrl.ErrorMsg}}</div>
                        <div>
                            <ng-form name="frmTemplate">
                                <div style="display: table; height:100%;width:100%; border-spacing: 6px; vertical-align:top">
                                    <div style="display: table-row; height :100%">
                                        <div class="tableCell">Task options:</div>
                                        <div class="tableCell" style="width:100%"><textarea style=" width: 100%; height: 100%; min-height:400px;" ng-model="ctrl.TaskOptions"></textarea></div>
                                    </div>
                                    <div style="display: table-row; height :100%">
                                        <div class="tableCell">User Story options:</div>
                                        <div class="tableCell" style="width:100%"><textarea style=" width: 100%; height: 100%; min-height:400px;" ng-model="ctrl.UserStoryOptions"></textarea></div>
                                    </div>
                            </ng-form>
                        </div>
                        <div id="footer" style="width:100%;text-align:right;height:60px;">
                            <hr />
                            <button ng-click="ctrl.Save()">Save</button>
                            <button ng-click="ctrl.Reset()">Delete</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>